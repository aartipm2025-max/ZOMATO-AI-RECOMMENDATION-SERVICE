<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zomato AI â€” Find Your Perfect Restaurant</title>
  <meta name="description"
    content="AI-powered restaurant recommendations based on your preferences. Powered by Groq LLM and the Zomato dataset." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Playfair+Display:wght@700;800&display=swap"
    rel="stylesheet" />
  <style>
    /* â”€â”€â”€ Design Tokens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      --white: #ffffff;
      --cream: #faf9f6;
      --surface: #f2f0eb;
      --border: #e5e1d8;
      --shadow: rgba(0, 0, 0, 0.07);
      --text: #1a1a1a;
      --muted: #6b6b6b;
      --light: #aaaaaa;
      --red: #c0392b;
      --red-light: #fdf0ef;
      --black: #111111;
      --black-hover: #333333;
      --radius: 16px;
      --radius-sm: 10px;
      --tr: .2s cubic-bezier(.4, 0, .2, 1);
      font-family: 'Inter', ui-sans-serif, system-ui, sans-serif;
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      background: var(--cream);
      color: var(--text);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    /* â”€â”€â”€ Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 48px;
      background: var(--white);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 1px 10px var(--shadow);
    }

    .nav-logo {
      font-family: 'Playfair Display', serif;
      font-size: 21px;
      font-weight: 800;
      color: var(--red);
      letter-spacing: -.3px;
    }

    .nav-logo span {
      color: var(--black);
    }

    .nav-links {
      display: flex;
      gap: 30px;
      list-style: none;
    }

    .nav-links a {
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      color: var(--muted);
      transition: color var(--tr);
    }

    .nav-links a:hover,
    .nav-links a.active {
      color: var(--text);
    }

    .nav-links a.active {
      font-weight: 700;
      color: var(--red);
    }

    /* â”€â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hero {
      position: relative;
      text-align: center;
      padding: 52px 24px 44px;
      background: var(--white);
      overflow: hidden;
      border-bottom: 1px solid var(--border);
    }

    /* food floats */
    .food-float {
      position: absolute;
      pointer-events: none;
      user-select: none;
      font-size: 68px;
      line-height: 1;
      top: 50%;
      transform: translateY(-50%);
    }

    .food-float.fl {
      left: 7%;
      animation: bobL 4s ease-in-out infinite;
    }

    .food-float.fr {
      right: 7%;
      animation: bobR 4.2s ease-in-out infinite;
    }

    @keyframes bobL {

      0%,
      100% {
        transform: translateY(-50%) rotate(-8deg)
      }

      50% {
        transform: translateY(calc(-50% - 12px)) rotate(-8deg)
      }
    }

    @keyframes bobR {

      0%,
      100% {
        transform: translateY(-50%) rotate(10deg)
      }

      50% {
        transform: translateY(calc(-50% - 10px)) rotate(10deg)
      }
    }

    /* sparkles */
    .sp {
      position: absolute;
      pointer-events: none;
      font-size: 16px;
      color: var(--red);
      opacity: .5;
      animation: spk 3s ease-in-out infinite;
    }

    .sp:nth-of-type(1) {
      top: 16%;
      left: 23%;
      animation-delay: .0s
    }

    .sp:nth-of-type(2) {
      top: 72%;
      left: 32%;
      animation-delay: 1.2s
    }

    .sp:nth-of-type(3) {
      top: 18%;
      right: 24%;
      animation-delay: .5s
    }

    .sp:nth-of-type(4) {
      top: 68%;
      right: 30%;
      animation-delay: 1.8s
    }

    .sp:nth-of-type(5) {
      top: 8%;
      left: 52%;
      animation-delay: .9s
    }

    @keyframes spk {

      0%,
      100% {
        opacity: .3;
        transform: scale(.9)
      }

      50% {
        opacity: .8;
        transform: scale(1.2) rotate(15deg)
      }
    }

    .hero-content {
      position: relative;
      z-index: 1;
    }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .9px;
      text-transform: uppercase;
      color: var(--red);
      background: var(--red-light);
      border: 1px solid rgba(192, 57, 43, .18);
      border-radius: 999px;
      padding: 5px 14px;
      margin-bottom: 18px;
    }

    .hero-badge .dot {
      width: 6px;
      height: 6px;
      background: var(--red);
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
        transform: scale(1)
      }

      50% {
        opacity: .4;
        transform: scale(.7)
      }
    }

    .hero h1 {
      font-family: 'Playfair Display', serif;
      font-size: clamp(28px, 5vw, 52px);
      font-weight: 800;
      line-height: 1.15;
      margin-bottom: 12px;
    }

    .hero h1 .red {
      color: var(--red);
    }

    .hero h1 .dark {
      color: var(--black);
    }

    .hero p {
      font-size: 15px;
      color: var(--muted);
      max-width: 460px;
      margin: 0 auto;
      line-height: 1.65;
    }

    /* â”€â”€â”€ Main content wrapper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .main {
      padding: 36px 20px 60px;
    }

    /* â”€â”€â”€ Glass/white filter card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .filter-card {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 28px 30px 22px;
      max-width: 800px;
      margin: 0 auto 28px;
      box-shadow: 0 4px 20px var(--shadow);
    }

    .filter-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .9px;
      color: var(--light);
      margin-bottom: 18px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 14px;
    }

    .col-6 {
      grid-column: span 6;
    }

    .col-4 {
      grid-column: span 4;
    }

    .col-12 {
      grid-column: span 12;
    }

    .field label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      margin-bottom: 6px;
      letter-spacing: .3px;
    }

    .field input[type=number],
    .field input[type=text] {
      width: 100%;
      padding: 10px 14px;
      border-radius: var(--radius-sm);
      border: 1.5px solid var(--border);
      background: var(--cream);
      color: var(--text);
      font-family: inherit;
      font-size: 14px;
      outline: none;
      transition: border-color var(--tr), box-shadow var(--tr);
    }

    .field input::placeholder {
      color: var(--light);
    }

    .field input:focus {
      border-color: var(--black);
      box-shadow: 0 0 0 3px rgba(17, 17, 17, .1);
    }

    /* â”€â”€â”€ Location dropdown â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .loc-wrap {
      position: relative;
    }

    .loc-row {
      display: flex;
      align-items: center;
      background: var(--cream);
      border: 1.5px solid var(--border);
      border-radius: var(--radius-sm);
      transition: border-color var(--tr), box-shadow var(--tr);
    }

    .loc-row.open,
    .loc-row:focus-within {
      border-color: var(--black);
      box-shadow: 0 0 0 3px rgba(17, 17, 17, .1);
    }

    .loc-row.open {
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
    }

    #loc-input {
      flex: 1;
      padding: 10px 14px;
      background: transparent;
      border: none;
      color: var(--text);
      font-family: inherit;
      font-size: 14px;
      outline: none;
    }

    #loc-input::placeholder {
      color: var(--light);
    }

    .loc-clear {
      padding: 0 6px 0 2px;
      color: var(--light);
      cursor: pointer;
      display: none;
      align-items: center;
      flex-shrink: 0;
      transition: color var(--tr);
    }

    .loc-clear:hover {
      color: var(--red);
    }

    .loc-clear.show {
      display: flex;
    }

    .loc-chevron {
      padding: 0 12px 0 2px;
      color: var(--light);
      cursor: pointer;
      display: flex;
      align-items: center;
      flex-shrink: 0;
      transition: transform var(--tr), color var(--tr);
    }

    .loc-chevron:hover {
      color: var(--text);
    }

    .loc-row.open .loc-chevron {
      transform: rotate(180deg);
      color: var(--black);
    }

    .loc-dropdown {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      z-index: 300;
      background: var(--white);
      border: 1.5px solid var(--black);
      border-top: none;
      border-bottom-left-radius: var(--radius-sm);
      border-bottom-right-radius: var(--radius-sm);
      max-height: 240px;
      overflow-y: auto;
      box-shadow: 0 12px 30px rgba(0, 0, 0, .12);
      scrollbar-width: thin;
      scrollbar-color: rgba(0, 0, 0, .2) transparent;
    }

    .loc-dropdown.open {
      display: block;
    }

    .loc-opt {
      padding: 9px 14px;
      font-size: 14px;
      cursor: pointer;
      color: var(--muted);
      border-bottom: 1px solid var(--border);
      transition: background var(--tr), color var(--tr);
    }

    .loc-opt:last-child {
      border-bottom: none;
    }

    .loc-opt:hover,
    .loc-opt.on {
      background: var(--surface);
      color: var(--text);
    }

    .loc-opt mark {
      background: transparent;
      color: var(--black);
      font-weight: 700;
    }

    .loc-none {
      padding: 10px 14px;
      font-size: 13px;
      color: var(--light);
      font-style: italic;
    }

    .loc-spin-wrap {
      padding: 10px 14px;
      font-size: 13px;
      color: var(--light);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .loc-spin {
      width: 13px;
      height: 13px;
      border: 2px solid rgba(0, 0, 0, .15);
      border-top-color: var(--black);
      border-radius: 50%;
      animation: spin .6s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg)
      }
    }

    /* â”€â”€â”€ CTA (centred) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .cta-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-bottom: 44px;
    }

    .btn-go {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 14px 44px;
      border: none;
      border-radius: 999px;
      background: var(--black);
      color: var(--white);
      font-family: inherit;
      font-size: 16px;
      font-weight: 800;
      cursor: pointer;
      letter-spacing: .2px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, .22);
      transition: transform var(--tr), box-shadow var(--tr), background var(--tr);
    }

    .btn-go:hover {
      background: var(--black-hover);
      transform: translateY(-2px);
      box-shadow: 0 10px 28px rgba(0, 0, 0, .3);
    }

    .btn-go:active {
      transform: translateY(0);
    }

    .btn-go:disabled {
      opacity: .5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-spinner {
      display: none;
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255, 255, 255, .3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin .6s linear infinite;
    }

    .btn-go.loading .btn-spinner {
      display: inline-block;
    }

    .btn-go.loading .btn-icon {
      display: none;
    }

    .status {
      font-size: 13px;
      color: var(--muted);
    }

    .status.err {
      color: var(--red);
      font-weight: 600;
    }

    /* â”€â”€â”€ Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .results-section {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 0 60px;
    }

    .results-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
    }

    .results-header h2 {
      font-family: 'Playfair Display', serif;
      font-size: 22px;
      font-weight: 800;
    }

    .result-count {
      font-size: 11px;
      font-weight: 700;
      background: var(--surface);
      color: var(--muted);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 3px 12px;
    }

    .summary-box {
      background: var(--white);
      border: 1.5px solid var(--border);
      border-left: 4px solid var(--black);
      border-radius: var(--radius-sm);
      padding: 14px 18px;
      font-size: 14px;
      line-height: 1.7;
      color: var(--muted);
      margin-bottom: 18px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(290px, 1fr));
      gap: 16px;
    }

    /* â”€â”€â”€ Restaurant card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .r-card {
      background: var(--white);
      border: 1.5px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      transition: transform var(--tr), border-color var(--tr), box-shadow var(--tr);
      animation: fadeUp .38s ease both;
    }

    .r-card:hover {
      transform: translateY(-4px);
      border-color: var(--black);
      box-shadow: 0 12px 32px rgba(0, 0, 0, .1);
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(14px)
      }

      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    .r-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }

    .r-name {
      font-size: 16px;
      font-weight: 700;
      line-height: 1.3;
      flex: 1;
      margin-right: 10px;
    }

    .r-rating {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 13px;
      font-weight: 700;
      color: #b7791f;
      background: #fefce8;
      border: 1px solid #fde68a;
      border-radius: 8px;
      padding: 4px 9px;
      white-space: nowrap;
    }

    .r-rating svg {
      width: 12px;
      height: 12px;
      fill: #b7791f;
    }

    .r-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .r-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: var(--cream);
    }

    .r-pill svg {
      width: 11px;
      height: 11px;
      opacity: .55;
    }

    .r-cuisines {
      font-size: 12px;
      color: var(--light);
      margin-bottom: 10px;
    }

    .r-reason {
      font-size: 13px;
      line-height: 1.55;
      color: var(--muted);
      padding-top: 10px;
      border-top: 1px solid var(--border);
    }

    .r-reason strong {
      color: var(--red);
      font-weight: 600;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: var(--light);
      grid-column: 1/-1;
      font-size: 14px;
    }

    /* â”€â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .footer {
      text-align: center;
      padding: 22px 0 32px;
      font-size: 12px;
      color: var(--light);
      border-top: 1px solid var(--border);
    }

    .footer a {
      color: var(--black);
      text-decoration: none;
      font-weight: 600;
    }

    /* â”€â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media(max-width:768px) {
      nav {
        padding: 14px 18px;
      }

      .nav-links {
        display: none;
      }

      .food-float {
        font-size: 40px;
      }

      .col-6,
      .col-4 {
        grid-column: span 12;
      }

      .filter-card {
        padding: 18px;
      }

      .results-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>

  <!-- â•â• Nav â•â• -->
  <nav>
    <div class="nav-logo">Zomato<span>AI</span></div>
    <ul class="nav-links">
      <li><a href="#" class="active">Home</a></li>
      <li><a href="/docs" target="_blank">API Docs</a></li>
      <li><a href="#results-anchor">Results</a></li>
    </ul>
  </nav>

  <!-- â•â• Hero â•â• -->
  <section class="hero">
    <span class="sp">âœ¦</span>
    <span class="sp">âœ¶</span>
    <span class="sp">âœ¦</span>
    <span class="sp">âœ¶</span>
    <span class="sp">â‹†</span>
    <div class="food-float fl">ğŸ•</div>
    <div class="food-float fr">ğŸœ</div>
    <div class="hero-content">
      <div class="hero-badge"><span class="dot"></span> AI-Powered</div>
      <h1>
        <span class="red">Explore</span> the<br>
        <span class="dark">World's</span> Cuisines!
      </h1>
      <p>Discover the perfect restaurant â€” filtered from thousands of options and ranked by AI, just for you.</p>
    </div>
  </section>

  <!-- â•â• Filter form â•â• -->
  <div class="main">
    <div class="filter-card">
      <div class="filter-title">Your Preferences</div>
      <div class="form-grid">

        <!-- Location searchable dropdown -->
        <div class="col-6 field">
          <label>ğŸ“ Location</label>
          <div class="loc-wrap">
            <div class="loc-row" id="loc-row">
              <input id="loc-input" type="text" placeholder="Search or select a locationâ€¦" autocomplete="off"
                role="combobox" aria-expanded="false" aria-autocomplete="list" aria-controls="loc-listbox" />
              <span class="loc-clear" id="loc-clear" role="button" title="Clear" tabindex="0">
                <svg viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5"
                  stroke-linecap="round">
                  <line x1="18" y1="6" x2="6" y2="18" />
                  <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
              </span>
              <span class="loc-chevron" id="loc-chevron" role="button" tabindex="0">
                <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5"
                  stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9" />
                </svg>
              </span>
            </div>
            <div class="loc-dropdown" id="loc-listbox" role="listbox">
              <div class="loc-spin-wrap" id="loc-loading"><span class="loc-spin"></span> Loadingâ€¦</div>
            </div>
          </div>
        </div>

        <!-- Min Rating -->
        <div class="col-6 field">
          <label>â­ Min Rating</label>
          <input id="min_rating" type="number" step="0.1" min="0" max="5" placeholder="e.g., 4.0" />
        </div>

        <!-- Min / Max Price -->
        <div class="col-4 field">
          <label>ğŸ’° Min Price (â‚¹)</label>
          <input id="min_price" type="number" min="0" placeholder="e.g., 200" />
        </div>
        <div class="col-4 field">
          <label>ğŸ’° Max Price (â‚¹)</label>
          <input id="max_price" type="number" min="0" placeholder="e.g., 1500" />
        </div>

        <!-- Cuisines with datalist from dataset -->
        <div class="col-4 field">
          <label>ğŸ½ï¸ Cuisines</label>
          <input id="cuisines" type="text" placeholder="e.g., Italian, Chinese" list="cuisines-list"
            autocomplete="off" />
          <datalist id="cuisines-list"></datalist>
        </div>

      </div>
    </div>

    <!-- â•â• CTA centred â•â• -->
    <div class="cta-wrap">
      <button class="btn-go" id="go">
        <span class="btn-icon">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8" />
            <line x1="21" y1="21" x2="16.65" y2="16.65" />
          </svg>
        </span>
        <span class="btn-spinner"></span>
        Get Recommendations
      </button>
      <span class="status" id="status"></span>
    </div>

    <!-- â•â• Results â•â• -->
    <div class="results-section" id="results-section" style="display:none;">
      <div id="results-anchor"></div>
      <div class="results-header">
        <h2>Recommendations</h2>
        <span class="result-count" id="result-count"></span>
      </div>
      <div class="summary-box" id="summary-box"></div>
      <div class="results-grid" id="results-grid"></div>
    </div>
  </div>

  <!-- â•â• Footer â•â• -->
  <footer class="footer">
    Built with FastAPI + Groq LLM &middot; <a href="/docs" target="_blank">API Docs</a>
  </footer>

  <script>
    'use strict';

    /* â”€â”€ helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const $ = id => document.getElementById(id);
    function escapeHTML(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
    function toNum(v) { const s = (v || '').trim(); if (!s) return undefined; const n = Number(s); return isFinite(n) ? n : undefined; }
    function toInt(v) { const n = toNum(v); return n === undefined ? undefined : Math.trunc(n); }
    function toCuisines(v) { const s = (v || '').trim(); if (!s) return undefined; return s.split(',').map(x => x.trim()).filter(Boolean); }

    /* â”€â”€ location dropdown state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const locInput = $('loc-input');
    const locRow = $('loc-row');
    const locListbox = $('loc-listbox');
    const locLoading = $('loc-loading');
    const locClear = $('loc-clear');
    const locChevron = $('loc-chevron');
    let allLocs = [];
    let focusIdx = -1;

    async function loadLocations() {
      try { const r = await fetch('/locations'); allLocs = await r.json(); }
      catch (_) { allLocs = []; }
      locLoading.style.display = 'none';
      renderOpts('');
    }

    function hl(text, q) {
      if (!q) return escapeHTML(text);
      const i = text.toLowerCase().indexOf(q.toLowerCase());
      if (i < 0) return escapeHTML(text);
      return escapeHTML(text.slice(0, i)) + '<mark>' + escapeHTML(text.slice(i, i + q.length)) + '</mark>' + escapeHTML(text.slice(i + q.length));
    }

    function renderOpts(q) {
      locListbox.querySelectorAll('.loc-opt, .loc-none').forEach(el => el.remove());
      focusIdx = -1;
      const list = q ? allLocs.filter(l => l.toLowerCase().includes(q.toLowerCase())) : allLocs;
      if (!list.length) {
        const d = document.createElement('div'); d.className = 'loc-none';
        d.textContent = q ? `No matches for "${q}"` : 'No locations loaded';
        locListbox.appendChild(d); return;
      }
      list.forEach(loc => {
        const d = document.createElement('div');
        d.className = 'loc-opt'; d.role = 'option'; d.dataset.value = loc;
        d.innerHTML = hl(loc, q);
        d.addEventListener('mousedown', e => { e.preventDefault(); pickLoc(loc); });
        locListbox.appendChild(d);
      });
    }

    function pickLoc(v) { locInput.value = v; closeLocDrop(); updateClear(); }
    function openLocDrop() { locRow.classList.add('open'); locListbox.classList.add('open'); locInput.setAttribute('aria-expanded', 'true'); renderOpts(locInput.value); }
    function closeLocDrop() { locRow.classList.remove('open'); locListbox.classList.remove('open'); locInput.setAttribute('aria-expanded', 'false'); focusIdx = -1; clearFocus(); }
    function updateClear() { locClear.classList.toggle('show', !!locInput.value.trim()); }
    function clearFocus() { locListbox.querySelectorAll('.loc-opt.on').forEach(e => e.classList.remove('on')); }
    function moveFocus(d) {
      const opts = [...locListbox.querySelectorAll('.loc-opt')]; if (!opts.length) return;
      clearFocus(); focusIdx = Math.max(0, Math.min(opts.length - 1, focusIdx + d));
      opts[focusIdx].classList.add('on'); opts[focusIdx].scrollIntoView({ block: 'nearest' });
    }

    locInput.addEventListener('focus', openLocDrop);
    locInput.addEventListener('input', () => { openLocDrop(); renderOpts(locInput.value); updateClear(); });
    locInput.addEventListener('keydown', e => {
      const open = locListbox.classList.contains('open');
      if (e.key === 'ArrowDown') { e.preventDefault(); open ? moveFocus(1) : openLocDrop(); }
      else if (e.key === 'ArrowUp') { e.preventDefault(); moveFocus(-1); }
      else if (e.key === 'Enter') { const f = locListbox.querySelector('.loc-opt.on'); if (f) { e.preventDefault(); pickLoc(f.dataset.value); } else closeLocDrop(); }
      else if (e.key === 'Escape' || e.key === 'Tab') closeLocDrop();
    });
    locChevron.addEventListener('mousedown', e => { e.preventDefault(); locListbox.classList.contains('open') ? closeLocDrop() : (locInput.focus(), openLocDrop()); });
    locClear.addEventListener('mousedown', e => { e.preventDefault(); locInput.value = ''; updateClear(); locInput.focus(); openLocDrop(); });
    document.addEventListener('mousedown', e => { if (!locRow.contains(e.target) && !locListbox.contains(e.target)) closeLocDrop(); });

    /* â”€â”€ cuisines datalist (from /cuisines endpoint) â”€â”€â”€â”€â”€â”€ */
    async function loadCuisines() {
      try {
        const r = await fetch('/cuisines');
        const list = await r.json();
        const dl = $('cuisines-list');
        list.forEach(c => { const opt = document.createElement('option'); opt.value = c; dl.appendChild(opt); });
      } catch (_) { /* non-critical */ }
    }

    /* â”€â”€ render result cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function starSVG() {
      return '<svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01z"/></svg>';
    }

    function renderResults(data) {
      $('results-section').style.display = 'block';
      $('summary-box').textContent = data.summary || '';
      const recs = data.recommendations || [];
      $('result-count').textContent = recs.length + ' found';
      const grid = $('results-grid');
      grid.innerHTML = '';

      if (!recs.length) {
        grid.innerHTML = '<div class="empty-state">No restaurants matched. Try broadening your filters.</div>';
        return;
      }

      recs.forEach((r, i) => {
        const card = document.createElement('div');
        card.className = 'r-card';
        card.style.animationDelay = (i * 0.06) + 's';
        card.innerHTML = `
            <div class="r-top">
              <div class="r-name">${escapeHTML(r.name)}</div>
              <div class="r-rating">${starSVG()} ${r.rating != null ? Number(r.rating).toFixed(1) : 'â€”'}</div>
            </div>
            <div class="r-meta">
              <span class="r-pill">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                ${escapeHTML(r.location || 'â€”')}
              </span>
              <span class="r-pill">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                ${r.price_range != null ? 'â‚¹' + Number(r.price_range).toLocaleString() : 'â€”'}
              </span>
            </div>
            ${r.cuisines ? `<div class="r-cuisines">${escapeHTML(r.cuisines)}</div>` : ''}
            <div class="r-reason"><strong>Why this pick:</strong> ${escapeHTML(r.reason || '')}</div>
          `;
        grid.appendChild(card);
      });

      $('results-anchor').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    /* â”€â”€ main fetch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function run() {
      const btn = $('go');
      const status = $('status');
      btn.classList.add('loading');
      btn.disabled = true;
      status.className = 'status';
      status.textContent = 'Finding the best restaurantsâ€¦';
      closeLocDrop();

      try {
        const payload = {
          location: locInput.value.trim() || undefined,
          min_rating: toNum($('min_rating').value),
          min_price: toInt($('min_price').value),
          max_price: toInt($('max_price').value),
          preferred_cuisines: toCuisines($('cuisines').value),
          limit: 5,
        };

        const resp = await fetch('/recommendations/pipeline', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });

        const data = await resp.json();
        if (!resp.ok) throw new Error(data?.detail || 'Server error ' + resp.status);
        renderResults(data);
        status.textContent = 'âœ“ Done';

      } catch (err) {
        status.textContent = 'Error: ' + (err.message || err);
        status.className = 'status err';
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    }

    /* Enter key in inputs triggers search */
    ['min_rating', 'min_price', 'max_price', 'cuisines'].forEach(id => {
      $(id).addEventListener('keydown', e => { if (e.key === 'Enter') run(); });
    });
    $('go').addEventListener('click', run);

    /* â”€â”€ bootstrap â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    loadLocations();
    loadCuisines();
  </script>
</body>

</html>